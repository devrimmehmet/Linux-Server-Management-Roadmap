ğŸ“¦ deploy-mssql-pvc.sh
#!/bin/bash

# ==============================

# MSSQL Kubernetes Quick Setup (PVC ile KalÄ±cÄ± Disk)

# ==============================

# 1. Namespace oluÅŸtur

kubectl create namespace mssql --dry-run=client -o yaml | kubectl apply -f -

# 2. SA Password iÃ§in Secret oluÅŸtur

kubectl delete secret mssql-secret -n mssql --ignore-not-found
kubectl create secret generic mssql-secret \
 --from-literal=SA_PASSWORD="MyPass1234" \
 -n mssql

# 3. PersistentVolume (hostPath tabanlÄ±, test iÃ§in)

cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: PersistentVolume
metadata:
name: mssql-pv
spec:
capacity:
storage: 5Gi
accessModes: - ReadWriteOnce
hostPath:
path: /data/mssql
EOF

# 4. PersistentVolumeClaim

cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: mssql-pvc
namespace: mssql
spec:
accessModes: - ReadWriteOnce
resources:
requests:
storage: 5Gi
EOF

# 5. Deployment

cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
name: mssql-deployment
namespace: mssql
spec:
replicas: 1
selector:
matchLabels:
app: mssql
template:
metadata:
labels:
app: mssql
spec:
containers: - name: mssql
image: mcr.microsoft.com/mssql/server:2022-latest
ports: - containerPort: 1433
env: - name: ACCEPT_EULA
value: "Y" - name: MSSQL_SA_PASSWORD
valueFrom:
secretKeyRef:
name: mssql-secret
key: SA_PASSWORD
volumeMounts: - name: mssqldata
mountPath: /var/opt/mssql
volumes: - name: mssqldata
persistentVolumeClaim:
claimName: mssql-pvc
EOF

# 6. Service

cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
name: mssql-service
namespace: mssql
spec:
type: NodePort
selector:
app: mssql
ports:

- port: 1433
  targetPort: 1433
  nodePort: 31433
  EOF

# 7. Durum bilgisi

echo "âœ… MSSQL PVC ile deployment tamamlandÄ±"
kubectl get pods -n mssql -o wide
kubectl get svc -n mssql

ğŸ“– KullanÄ±m

Dosya oluÅŸtur:

nano deploy-mssql-pvc.sh

Kaydet â†’ Ã§alÄ±ÅŸtÄ±rÄ±labilir yap:

chmod +x deploy-mssql-pvc.sh

Ã‡alÄ±ÅŸtÄ±r:

./deploy-mssql-pvc.sh

SQL verileri artÄ±k ÅŸurada kalÄ±cÄ± olacak:

/data/mssql

Node Ã¼zerinde silinmedikÃ§e pod silinse bile veriler korunur âœ…
