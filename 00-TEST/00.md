# 🔐 Ubuntu Ubuntu 22.04.5 LTS – SSH Kurulumu ve Güvenli Port Değişikliği Rehberi

Bu doküman, **Ubuntu Server Ubuntu 22.04.5 LTS** üzerinde **SSH servisini kurmak, güvenli hale getirmek ve farklı bir port üzerinden dış dünyadan erişim sağlamak** için adım adım yapılması gereken işlemleri içerir.

---

## 1️⃣ SSH Servisini Kur ve Başlat

Öncelikle SSH servisini yükleyip aktif hale getiriyoruz:

```bash
sudo apt update
sudo apt install -y openssh-server
sudo systemctl enable ssh
sudo systemctl start ssh
```

## 2️⃣ Sunucu IP Adresini Kontrol Et

Yerel ağ IP’sini öğrenmek için:

```bash
ip a
```

👉 Bizim senaryomuzda Local IP: 192.168.1.2

## 3️⃣ Firewall (UFW) Ayarları

Varsayılan SSH kuralını açıyoruz:

```bash
sudo ufw allow OpenSSH
sudo ufw enable
```

## ️⃣ SSH Bağlantısını Test Et (Varsayılan Port 22)

Aynı ağdan bağlanmayı test et:

```bash
ssh kullaniciadi@192.168.1.2
```

👉 Bu noktada SSH default olarak 22. port üzerinden çalışır.

## 5️⃣ SSH Servis Durumunu Kontrol Et

SSH’in çalışıp çalışmadığını görmek için:

```bash
sudo systemctl status ssh
```

## ️⃣ SSH Portunu Değiştir (Örn: 2293)

Daha güvenli bir port kullanmak için sshd_config dosyasını düzenle:

```bash
sudo nano /etc/ssh/sshd_config
```

( #Port 22 ) Şu satırı bul ve değiştir (başındaki # işaretini kaldır):

```bash
Port 2293
```

## 7️⃣ Systemd Socket Override’ı Kapat

Ubuntu’da SSH varsayılan olarak ssh.socket üzerinden 22. portta dinlemeye devam edebilir.
Bunu kapatmak için:

```bash
sudo systemctl stop ssh.socket
sudo systemctl disable ssh.socket

```

## 8️⃣ Firewall’u Yeni Porta Göre Düzenle

Yeni portu açıp, 22’yi kapatıyoruz:

```bash
sudo ufw allow 2293/tcp
sudo ufw delete allow 22/tcp
sudo ufw reload
```

## 9️⃣ SSH Servisini Yeniden Başlat

Değişikliklerin uygulanması için servisi yeniden başlatıyoruz:

```bash
sudo systemctl restart ssh
```

Durumu tekrar kontrol et:

```bash
sudo ss -tulpn | grep ssh
```

👉 Çıktıda artık 0.0.0.0:2293 görmelisin.

## 🔟 Aynı Ağdan Test Et

```bash
ssh devrimmehmet@192.168.1.2 -p 2293
```

## 1️⃣1️⃣ Modem NAT (Port Forwarding) Ayarı

Dış dünyadan erişim için modemden NAT kuralı aç:

```bash
WAN (Dış IP): 159.146.105.13
Port (Dış): 2293

LAN (Sunucu IP): 192.168.1.2

Port (Hedef): 2293
```

## 1️⃣2️⃣ Dış Dünyadan Test Et

Artık başka bir ağdan şu komutla bağlanabilirsin:

```bash
ssh devrimmehmet@159.146.105.13 -p 2293
```

## 1️⃣3️⃣ 🔑 SSH Key Authentication (Şifreyi Kapat, Sadece Anahtar ile Giriş)

### 1️⃣ Windows’ta SSH Anahtarı Oluştur

PowerShell’de:

```bash
ssh-keygen -t ed25519 -C "devrimmehmet"
```

👉 Anahtarlar şu dizine kaydedilir:

```bash
C:\Users\<username>\.ssh\id_ed25519 (private key)
C:\Users\<username>\.ssh\id_ed25519.pub (public key)
```

### 2️⃣ Public Key’i Ubuntu’ya Kopyala

```bash
scp -P 2293 C:\Users\<username>\.ssh\id_ed25519.pub devrimmehmet@192.168.1.2:/home/devrimmehmet/
```

```bash
scp -P 2293 C:\Users\devri\.ssh\id_ed25519.pub devrimmehmet@192.168.1.2:/home/devrimmehmet/
```

Ubuntu’da:

```bash
mkdir -p ~/.ssh
mv ~/id_ed25519.pub ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

### 3️⃣ SSH Konfigürasyonunu Düzenle

```bash
sudo nano /etc/ssh/sshd_config
```

Şu satırların olduğundan emin ol:

```bash
Port 2293
PubkeyAuthentication yes
PasswordAuthentication no
PermitRootLogin no
```

### 4️⃣ SSH Servisini Yeniden Başlat

```bash
sudo systemctl restart ssh
```

### 5️⃣ Test Et

Windows PowerShell’den:

```bash
ssh -p 2293 devrimmehmet@159.146.105.13
```

👉 Eğer key authentication başarılıysa şifre sormadan giriş yapacaksın.

## 🛡️ Ekstra Güvenlik

Fail2ban Kur (brute force saldırılara karşı):

```bash
sudo apt install fail2ban -y
```

Root login kapalı (zaten PermitRootLogin no).

Sadece key ile giriş aktif (PasswordAuthentication no).

✅ Sonuç

SSH servisi kuruldu ve güvenli port 2293 üzerinden çalışıyor.

22. port kapatıldı ve sadece yeni port üzerinden erişim sağlanıyor.

Modem NAT kuralı ile dış dünyadan bağlanmak mümkün hale geldi.

SSH portu 2293 üzerinden güvenli şekilde çalışıyor.

Parola ile giriş devre dışı → sadece key ile bağlanılabiliyor.

Modem NAT sayesinde dış IP üzerinden her yerden erişim mümkün.

Fail2ban ile ek koruma sağlandı.
